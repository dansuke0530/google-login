<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Çπ„Éº„Éë„ÉºÁÆ°ÁêÜÁîªÈù¢</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;700;800&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Manrope', 'Noto Sans JP', sans-serif; margin: 0; padding: 0; background: #222; color: #fff; } /* ÁÆ°ÁêÜËÄÖ„Å£„ÅΩ„Åè„ÉÄ„Éº„ÇØ„É¢„Éº„ÉâÂü∫Ë™ø */
        
        .wrapper { max-width: 1000px; margin: 0 auto; padding: 60px 20px; }
        
        header { text-align: center; margin-bottom: 50px; }
        h1 { margin: 0; font-size: 24px; font-weight: 800; letter-spacing: 1px; }
        p.role { color: #00A3A0; font-size: 12px; font-weight: bold; margin-top: 5px; text-transform: uppercase; }

        /* „É°„Éã„É•„Éº„Éñ„É≠„ÉÉ„ÇØ */
        .admin-menu { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 60px; }
        
        .admin-card { 
            background: #333; padding: 40px 20px; border-radius: 12px; 
            text-align: center; text-decoration: none; color: #fff; transition: 0.3s;
            border: 1px solid #444; height: 160px; display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .admin-card:hover { background: #000; border-color: #00A3A0; transform: scale(1.02); }
        
        .icon { font-size: 32px; margin-bottom: 10px; display: block; }
        .card-label { font-weight: bold; font-size: 16px; }

        /* ÂÖ®„É™„Çπ„Éà„Ç®„É™„Ç¢ */
        .dashboard-area { background: #fff; color: #333; border-radius: 12px; padding: 30px; min-height: 400px; display: none; }
        .dashboard-area.active { display: block; animation: slideUp 0.4s ease; }

        .search-box { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 20px; }
        .input-std { padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; }
        
        .event-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .event-table th { text-align: left; color: #999; font-size: 11px; padding: 10px; border-bottom: 2px solid #eee; }
        .event-table td { padding: 15px 10px; border-bottom: 1px solid #eee; vertical-align: middle; }
        .thumb { width: 50px; height: 50px; border-radius: 4px; object-fit: cover; background: #eee; }
        
        .btn-act { padding: 5px 12px; border-radius: 4px; font-size: 11px; font-weight: bold; text-decoration: none; border: 1px solid #ddd; color: #333; }
        .btn-act:hover { background: #000; color: #fff; border-color: #000; }
        .btn-del { color: #ccc; background: none; border: none; font-size: 16px; cursor: pointer; margin-left: 10px; }
        .btn-del:hover { color: red; }

        .logout-btn { display: block; text-align: center; margin-top: 40px; color: #666; font-size: 12px; text-decoration: none; }
        
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @media (max-width: 768px) { .admin-menu { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="wrapper">
        <header>
            <h1>SUPER ADMIN</h1>
            <p class="role">ÂÖ®Ê®©ÈôêÁÆ°ÁêÜËÄÖ„É¢„Éº„Éâ</p>
        </header>

        <div class="admin-menu">
            <a href="admin.html" class="admin-card">
                <span class="icon">üìù</span>
                <span class="card-label">Êñ∞Ë¶è„Ç§„Éô„É≥„ÉàÁôªÈå≤</span>
            </a>
            <a href="javascript:void(0)" onclick="openDashboard()" class="admin-card">
                <span class="icon">üìä</span>
                <span class="card-label">ÂÖ®„Ç§„Éô„É≥„ÉàÁÆ°ÁêÜ</span>
            </a>
            <a href="index.html" class="admin-card" style="background:#00A3A0;">
                <span class="icon">üëÄ</span>
                <span class="card-label">„Çµ„Ç§„Éà„ÇíÁ¢∫Ë™ç</span>
            </a>
        </div>

        <div id="dashboard" class="dashboard-area">
            <div class="search-box">
                <input type="text" id="search-txt" class="input-std" placeholder="„Ç≠„Éº„ÉØ„Éº„ÉâÊ§úÁ¥¢..." style="flex:1;" oninput="filterList()">
                <input type="date" id="search-date" class="input-std" onchange="filterList()">
            </div>
            
            <table class="event-table">
                <thead>
                    <tr>
                        <th width="60">IMG</th>
                        <th>DATE</th>
                        <th>TITLE / ID</th>
                        <th width="100">ACTION</th>
                    </tr>
                </thead>
                <tbody id="list-body"></tbody>
            </table>
        </div>

        <a href="#" onclick="logout()" class="logout-btn">„É≠„Ç∞„Ç¢„Ç¶„Éà</a>
    </div>

    <script>
        const supabaseUrl = 'https://daexakehxcvspmthpzzf.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRhZXhha2VoeGN2c3BtdGhwenpmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgyMjc0ODgsImV4cCI6MjA4MzgwMzQ4OH0.xpHRjDPWlch_D80v1QQ9k_CJV6Q39pDa5f9qQ470rMI';
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
        const ADMIN_EMAIL = "kanaimori2024@gmail.com";
        let allData = [];

        function openDashboard() {
            document.getElementById('dashboard').classList.add('active');
            document.getElementById('dashboard').scrollIntoView({ behavior: 'smooth' });
        }

        async function init() {
            const { data: { user } } = await supabaseClient.auth.getUser();
            if (!user || user.email !== ADMIN_EMAIL) {
                alert("Ê®©Èôê„Åå„ÅÇ„Çä„Åæ„Åõ„Çì");
                window.location.href = 'index.html';
                return;
            }
            const { data, error } = await supabaseClient.from('events').select('*').order('date', { ascending: false });
            if(error) return alert("Error");
            allData = data;
            render(allData);
        }

        function render(list) {
            const tbody = document.getElementById('list-body');
            if(list.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding:20px;">„Éá„Éº„Çø„Å™„Åó</td></tr>';
                return;
            }
            tbody.innerHTML = list.map(ev => {
                const img = ev.image_url || 'https://placehold.co/50x50/eee/ccc?text=No';
                return `
                <tr>
                    <td><img src="${img}" class="thumb"></td>
                    <td style="color:#00A3A0; font-weight:bold;">${ev.date}</td>
                    <td>
                        <div style="font-weight:bold;">${ev.title}</div>
                        <div style="font-size:10px; color:#999;">ID: ${ev.id}</div>
                    </td>
                    <td>
                        <a href="edit.html?id=${ev.id}" class="btn-act">Á∑®ÈõÜ</a>
                        <button onclick="del('${ev.id}')" class="btn-del">√ó</button>
                    </td>
                </tr>
            `}).join('');
        }

        function filterList() {
            const txt = document.getElementById('search-txt').value.toLowerCase();
            const date = document.getElementById('search-date').value;
            const res = allData.filter(d => {
                const matchT = (d.title||'').toLowerCase().includes(txt) || (d.id||'').includes(txt);
                const matchD = date ? d.date === date : true;
                return matchT && matchD;
            });
            render(res);
        }

        async function del(id) {
            if(!confirm("Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü")) return;
            await supabaseClient.from('events').delete().eq('id', id);
            allData = allData.filter(d => d.id !== id);
            filterList();
        }
        async function logout() {
            await supabaseClient.auth.signOut();
            window.location.href = 'index.html';
        }
        init();
    </script>
</body>
</html>
