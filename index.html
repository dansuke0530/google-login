<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase Basic App</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; line-height: 1.6; }
        .card { border: 1px solid #ddd; padding: 20px; border-radius: 8px; margin-bottom: 20px; background: #fafafa; }
        button { cursor: pointer; padding: 10px 20px; background: #00A3A0; color: white; border: none; border-radius: 4px; }
        button:hover { opacity: 0.9; }
    </style>
</head>
<body>
    <h1>Supabase ã‚¢ãƒ—ãƒªã®åŸºæœ¬æ§‹é€ </h1>

    <div class="card">
        <h3>ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãƒ†ã‚¹ãƒˆ</h3>
        <p id="auth-status">ç¢ºèªä¸­...</p>
        <button id="login-btn" onclick="signIn()">Googleã§ãƒ­ã‚°ã‚¤ãƒ³</button>
        <button id="logout-btn" onclick="signOut()" style="background:#666; display:none;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
    </div>

    <div class="card">
        <h3>ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒ†ã‚¹ãƒˆ</h3>
        <p>ã‚¤ãƒ™ãƒ³ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™ï¼š</p>
        <div id="data-area">ï¼ˆã“ã“ã«ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰</div>
        <button onclick="fetchEvents()">ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—</button>
    </div>

    <script>
        // ==========================================
        // 2. åˆæœŸè¨­å®šï¼ˆã“ã“ã‚’ä¿®æ­£ã—ã¾ã—ãŸï¼ï¼‰
        // ==========================================
        const supabaseUrl = 'https://daexakehxcvspmthpzzf.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRhZXhha2VoeGN2c3BtdGhwenpmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgyMjc0ODgsImV4cCI6MjA4MzgwMzQ4OH0.xpHRjDPWlch_D80v1QQ9k_CJV6Q39pDa5f9qQ470rMI';
        
        // â˜…â˜…â˜… å¤‰æ›´ç‚¹ï¼šå¤‰æ•°åã‚’ 'supabase' ã‹ã‚‰ 'supabaseClient' ã«å¤‰æ›´ â˜…â˜…â˜…
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

        // ==========================================
        // 3. èªè¨¼æ©Ÿèƒ½ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ãƒ»ãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼‰
        // ==========================================
        async function signIn() {
            // ã“ã“ã‚‚ 'supabaseClient' ã‚’ä½¿ã†
            const { error } = await supabaseClient.auth.signInWithOAuth({
                provider: 'google',
                options: { redirectTo: window.location.href }
            });
            if (error) alert(error.message);
        }

        async function signOut() {
            // ã“ã“ã‚‚ 'supabaseClient' ã‚’ä½¿ã†
            const { error } = await supabaseClient.auth.signOut();
            if (!error) location.reload();
        }

        // ==========================================
        // 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œï¼ˆãƒ‡ãƒ¼ã‚¿ã®å–å¾—ï¼‰
        // ==========================================
        async function fetchEvents() {
            const display = document.getElementById('data-area');
            display.innerHTML = 'èª­ã¿è¾¼ã¿ä¸­...';

            // ã“ã“ã‚‚ 'supabaseClient' ã‚’ä½¿ã†
            const { data, error } = await supabaseClient
                .from('events')
                .select('*')
                .limit(5);

            if (error) {
                display.innerHTML = `<span style="color:red">ã‚¨ãƒ©ãƒ¼: ${error.message}</span>`;
            } else if (data.length === 0) {
                display.innerHTML = 'ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚';
            } else {
                display.innerHTML = data.map(item => `
                    <div style="border-bottom:1px solid #ccc; padding:5px;">
                        <strong>${item.title}</strong> (${new Date(item.date).toLocaleDateString()})
                    </div>
                `).join('');
            }
        }

        // ==========================================
        // 5. çŠ¶æ…‹ç›£è¦–
        // ==========================================
        async function checkUser() {
            // ã“ã“ã‚‚ 'supabaseClient' ã‚’ä½¿ã†
            const { data: { session } } = await supabaseClient.auth.getSession();
            const status = document.getElementById('auth-status');
            const loginBtn = document.getElementById('login-btn');
            const logoutBtn = document.getElementById('logout-btn');

            if (session) {
                status.innerHTML = `ãƒ­ã‚°ã‚¤ãƒ³ä¸­: <b>${session.user.email}</b>`;
                loginBtn.style.display = 'none';
                logoutBtn.style.display = 'inline-block';
            } else {
                status.innerText = 'æœªãƒ­ã‚°ã‚¤ãƒ³';
                loginBtn.style.display = 'inline-block';
                logoutBtn.style.display = 'none';
            }
        }

        checkUser();
    </script>
</body>
</html>
