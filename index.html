<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D4C Style - Events</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500&family=Manrope:wght@400;600&display=swap" rel="stylesheet">

    <style>
        /* --- ベース設定 --- */
        body { 
            font-family: 'Manrope', 'Noto Sans JP', sans-serif; 
            margin: 0; 
            background-color: #ffffff; 
            color: #1a1a1a; 
            font-size: 14px; /* 少し小さめで上品に */
            line-height: 1.8;
            letter-spacing: 0.05em; /* 文字間を少し開ける */
        }

        a { text-decoration: none; color: inherit; transition: 0.3s; }

        /* --- ヘッダー --- */
        header { 
            padding: 40px 5%; /* 左右にたっぷり余白 */
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; 
            background: rgba(255, 255, 255, 0.95); /* 少しだけ透けさせる */
            z-index: 100;
        }

        .logo { 
            font-size: 20px; 
            font-weight: 600; 
            letter-spacing: 0.1em;
        }

        /* ナビゲーション */
        .nav-links { display: flex; gap: 30px; align-items: center; }
        .nav-item { font-size: 13px; font-weight: 500; color: #888; text-transform: uppercase; }
        .nav-item:hover { color: #000; }
        
        .btn-login { 
            border: 1px solid #ddd; padding: 8px 20px; border-radius: 50px; 
            font-size: 12px; font-weight: 600;
        }
        .btn-login:hover { border-color: #000; background: #000; color: #fff; }
        .btn-login.mypage { background: #000; color: #fff; border-color: #000; }

        /* --- メインコンテンツ --- */
        .wrapper { 
            max-width: 1400px; /* 横幅を広めにとる */
            margin: 0 auto; 
            padding: 60px 5%; 
        }

        /* セクションタイトル */
        .page-title {
            font-size: 14px; 
            color: #aaa; 
            margin-bottom: 60px; 
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0.2em;
        }

        /* --- グリッドレイアウト --- */
        .event-grid { 
            display: grid; 
            /* PCでは3列、タブレットは2列、スマホは1列 */
            grid-template-columns: repeat(3, 1fr); 
            gap: 60px 40px; /* 縦の隙間60px, 横40px */
        }
        
        @media (max-width: 1024px) { .event-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 768px) { .event-grid { grid-template-columns: 1fr; gap: 40px; } header { padding: 20px 5%; } }

        /* --- カードデザイン（ミニマル） --- */
        .event-card { 
            cursor: pointer; 
            group: cursor; /* ホバー検知用 */
        }

        /* 画像エリア */
        .image-wrapper {
            width: 100%; 
            aspect-ratio: 16 / 10; /* 少し横長 */
            background-color: #f5f5f5; 
            margin-bottom: 20px;
            overflow: hidden; /* 拡大した画像をはみ出させない */
        }
        
        .card-image { 
            width: 100%; height: 100%; object-fit: cover; 
            transition: transform 0.6s cubic-bezier(0.165, 0.84, 0.44, 1); /* ゆったりとした拡大アニメーション */
            display: block;
        }

        /* ホバー時に画像をふわりと拡大 */
        .event-card:hover .card-image { transform: scale(1.05); }
        .event-card:hover .event-title { color: #666; }

        /* 画像がない場合のプレースホルダー */
        .no-image { 
            display: flex; align-items: center; justify-content: center; 
            width: 100%; height: 100%; 
            background: #f0f0f0; color: #ccc; font-size: 12px; letter-spacing: 0.1em;
        }

        /* テキストエリア */
        .event-info { display: flex; flex-direction: column; gap: 8px; }

        .event-date { 
            font-size: 12px; color: #999; 
            font-family: 'Manrope', sans-serif; /* 数字は英語フォントで綺麗に */
        }

        .event-title { 
            font-size: 16px; font-weight: 500; line-height: 1.6; 
            margin: 0; transition: 0.3s;
        }

        .event-desc { 
            font-size: 13px; color: #666; margin-top: 5px;
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
            opacity: 0.8;
        }

    </style>
</head>
<body>

    <header>
        <a href="index.html" class="logo">D4C INC.</a>
        
        <nav class="nav-links">
            <a href="#" class="nav-item">About</a>
            <a href="#" class="nav-item">Service</a>
            <a href="#" class="nav-item" style="color:#000; border-bottom:1px solid #000;">Works</a>
            
            <a id="auth-link" href="login.html" class="btn-login">LOGIN</a>
        </nav>
    </header>

    <div class="wrapper">
        <div class="page-title">Selected Works / Events</div>
        
        <div id="event-list" class="event-grid">
            <p style="color:#999; font-size:12px;">Loading...</p>
        </div>
    </div>

    <script>
        const supabaseUrl = 'https://daexakehxcvspmthpzzf.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRhZXhha2VoeGN2c3BtdGhwenpmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgyMjc0ODgsImV4cCI6MjA4MzgwMzQ4OH0.xpHRjDPWlch_D80v1QQ9k_CJV6Q39pDa5f9qQ470rMI';
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

        async function updateAuthButton() {
            const { data: { session } } = await supabaseClient.auth.getSession();
            const btn = document.getElementById('auth-link');
            if (session) { 
                btn.innerText = "MY PAGE"; 
                btn.href = "mypage.html"; 
                btn.classList.add('mypage'); 
            } else { 
                btn.innerText = "LOGIN"; 
                btn.href = "login.html"; 
            }
        }
        updateAuthButton();

        function formatDateDisplay(start, end) {
            const startDate = new Date(start);
            // 年.月.日 の形式 (例: 2026.04.01)
            const y = startDate.getFullYear();
            const m = String(startDate.getMonth() + 1).padStart(2, '0');
            const d = String(startDate.getDate()).padStart(2, '0');
            return `${y}.${m}.${d}`;
        }

        async function fetchEvents() {
            const listArea = document.getElementById('event-list');
            const { data, error } = await supabaseClient
                .from('events')
                .select('*')
                .order('date', { ascending: false }); // 新しい順

            if (error) return listArea.innerHTML = `<p>Error</p>`;
            if (!data || data.length === 0) return listArea.innerHTML = '<p style="color:#ccc;">No Events yet.</p>';

            listArea.innerHTML = data.map(event => `
                <div class="event-card" onclick="location.href='event.html?id=${event.id}'">
                    <div class="image-wrapper">
                        ${event.image_url 
                            ? `<img src="${event.image_url}" class="card-image" alt="${event.title}">` 
                            : `<div class="no-image">NO IMAGE</div>`
                        }
                    </div>
                    
                    <div class="event-info">
                        <span class="event-date">${formatDateDisplay(event.date)}</span>
                        <h3 class="event-title">${event.title}</h3>
                        <p class="event-desc">${event.short_desc || ''}</p>
                    </div>
                </div>
            `).join('');
        }
        fetchEvents();
    </script>
</body>
</html>
