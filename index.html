<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2685.3">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="ja"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;meta charset="UTF-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;title&gt;ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒˆ - Supabase Edition&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"&gt;&lt;/script&gt;</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; background-color: #f4f7f6; color: #333; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.container { max-width: 1200px; margin: 0 auto; padding: 20px; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>h1 { color: #00A3A0; text-align: center; margin: 20px 0; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>#fixed-header { position: sticky; top: 0; z-index: 1000; background: white; padding: 10px 20px; border-bottom: 1px solid #ddd; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>#search-controls { display: flex; gap: 10px; margin: 10px 0; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>#search-input { flex-grow: 1; padding: 8px; border-radius: 20px; border: 1px solid #ddd; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>#tag-list { padding: 10px 0; overflow-x: auto; white-space: nowrap; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.tag-button { background: white; margin-right: 5px; border-radius: 15px; padding: 5px 10px; border: 1px solid #ddd; font-size: 0.85em; cursor: pointer;}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.tag-button.active { background: #0ABAB5; color: white; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.main-content { display: flex; gap: 20px; align-items: flex-start; flex-wrap: wrap; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>#events-list { flex: 1; min-width: 300px; display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; }</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>#calendar-view { width: 280px; display: flex; flex-direction: column; gap: 20px; position: sticky; top: 150px; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.calendar-container { background: white; padding: 10px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.calendar-box { font-size: 11px; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.fc .fc-day-sun { background-color: #fff5f5 !important; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.fc .fc-day-sun .fc-col-header-cell-cushion, .fc .fc-day-sun .fc-daygrid-day-number { color: #EA4335 !important; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.fc .fc-day-sat { background-color: #f5faff !important; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.fc .fc-day-sat .fc-col-header-cell-cushion, .fc .fc-day-sat .fc-daygrid-day-number { color: #4285F4 !important; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.event-card { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: relative; display: flex; flex-direction: column; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.event-image { width: 100%; height: 160px; object-fit: cover; border-radius: 8px; margin-bottom: 10px; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.favorite-button { position: absolute; top: 10px; right: 10px; cursor: pointer; font-size: 20px; background: white; border-radius: 50%; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; z-index: 10; border: 1px solid #eee; }</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.action-buttons { display: flex; gap: 5px; margin-top: 10px; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.calendar-button, .line-button, .mail-button { flex: 1; font-size: 0.65em; padding: 10px 2px; text-decoration: none; text-align: center; border-radius: 20px; font-weight: bold; color: white !important; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.calendar-button { background: #4285F4; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.mail-button { background: #EA4335; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.line-button { background: #06C755; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>/* ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.review-section { margin-top: 15px; border-top: 1px solid #eee; padding-top: 10px; font-size: 0.85em; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.review-form { display: flex; flex-direction: column; gap: 5px; margin-bottom: 10px; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.star-input { color: #ddd; font-size: 1.5em; cursor: pointer; display: inline-block; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.star-input.active { color: #ffc107; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.review-input { width: 100%; padding: 5px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.review-item { background: #f9f9f9; padding: 8px; border-radius: 8px; margin-bottom: 5px; position: relative; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.review-header { display: flex; justify-content: space-between; font-weight: bold; font-size: 0.8em; color: #666; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.review-stars { color: #ffc107; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.review-text { margin-top: 3px; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.delete-review { color: #ff4d4d; cursor: pointer; font-size: 0.8em; text-decoration: underline; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>@media (max-width: 600px) { #calendar-view { width: 100%; position: static; order: -1; margin-bottom: 20px; } }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div id="fixed-header"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="container"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;h1&gt;EVENT LIST&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;div id="search-controls"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;input type="text" id="search-input" placeholder="æ¤œç´¢..."&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button id="search-button" style="padding: 8px 16px; background:#0ABAB5; color:white; border:none; border-radius:20px; cursor:pointer;"&gt;æ¤œç´¢&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;div id="tag-list"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;div style="text-align: right; margin-top: 5px;"&gt;&lt;a href="admin.html" style="font-size: 0.8em; color: #666;"&gt;ç®¡ç†è€…ãƒšãƒ¼ã‚¸ã¸&lt;/a&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="container"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="main-content"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;div id="events-list"&gt;èª­ã¿è¾¼ã¿ä¸­...&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;div id="calendar-view"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="calendar-container"&gt;&lt;div id="calendar-now" class="calendar-box"&gt;&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="calendar-container"&gt;&lt;div id="calendar-next" class="calendar-box"&gt;&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// â˜…â˜…â˜… Supabaseè¨­å®š â˜…â˜…â˜…</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const supabaseUrl = 'https://daexakehxcvspmthpzzf.supabase.co';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRhZXhha2VoeGN2c3BtdGhwenpmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgyMjc0ODgsImV4cCI6MjA4MzgwMzQ4OH0.xpHRjDPWlch_D80v1QQ9k_CJV6Q39pDa5f9qQ470rMI';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const supabase = supabase.createClient(supabaseUrl, supabaseKey);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let allEvents = [];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let favIds = new Set();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let currentTag = '';</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// ç°¡æ˜“çš„ãªãƒ¦ãƒ¼ã‚¶ãƒ¼IDç”Ÿæˆï¼ˆãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã®ä»£ã‚ã‚Šï¼‰</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let userId = localStorage.getItem('my_temp_user_id');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (!userId) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>userId = 'user_' + Math.random().toString(36).substr(2, 9);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>localStorage.setItem('my_temp_user_id', userId);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>function initCalendar(events) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const calendarEvents = events.map(e =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>// Supabaseã®æ—¥ä»˜æ–‡å­—åˆ—ã‚’JSã®Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const d = new Date(e.date);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>return { title: e.title, start: d.toISOString().split('T')[0], backgroundColor: '#00A3A0', borderColor: '#00A3A0' };</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const cNow = new FullCalendar.Calendar(document.getElementById('calendar-now'), {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>initialView: 'dayGridMonth', locale: 'ja', height: 'auto', events: calendarEvents, headerToolbar: { left: '', center: 'title', right: '' }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const nextMonth = new Date(); nextMonth.setMonth(nextMonth.getMonth() + 1);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const cNext = new FullCalendar.Calendar(document.getElementById('calendar-next'), {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>initialView: 'dayGridMonth', initialDate: nextMonth, locale: 'ja', height: 'auto', events: calendarEvents, headerToolbar: { left: '', center: 'title', right: '' }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>cNow.render(); cNext.render();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>async function load() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// ã‚¤ãƒ™ãƒ³ãƒˆå–å¾—</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (allEvents.length === 0) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const { data, error } = await supabase.from('events').select('*').order('date', { ascending: true });</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (error) { console.error(error); document.getElementById('events-list').innerText = "ã‚¨ãƒ©ãƒ¼: " + error.message; return; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>allEvents = data;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>initCalendar(allEvents);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>// ã‚¿ã‚°ç”Ÿæˆ</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const tags = new Set();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>allEvents.forEach(e =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const tList = Array.isArray(e.tags) ? e.tags : (e.tags || '').split(',');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>tList.forEach(t =&gt; t.trim() &amp;&amp; tags.add(t.trim()));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const tagList = document.getElementById('tag-list');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>tagList.innerHTML = `&lt;button class="tag-button active" id="tag-all"&gt;å…¨ã¦&lt;/button&gt;` + Array.from(tags).map(t =&gt; `&lt;button class="tag-button" data-tag="${t}"&gt;${t}&lt;/button&gt;`).join('');</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>tagList.onclick = (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (e.target.tagName !== 'BUTTON') return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>currentTag = e.target.dataset.tag || '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>Array.from(tagList.children).forEach(btn =&gt; btn.classList.toggle('active', btn === e.target));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>renderEvents();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>};</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>renderEvents();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>loadFavorites(); // ãŠæ°—ã«å…¥ã‚Šèª­ã¿è¾¼ã¿</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>async function loadFavorites() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const { data, error } = await supabase.from('favorites').select('event_id').eq('user_id', userId);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (!error &amp;&amp; data) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>favIds = new Set(data.map(f =&gt; f.event_id.toString())); // IDã‚’æ–‡å­—åˆ—ã§çµ±ä¸€</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>renderEvents(); // ãƒãƒ¼ãƒˆãƒãƒ¼ã‚¯æ›´æ–°ã®ãŸã‚å†æç”»</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>function renderEvents() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const key = document.getElementById('search-input').value.toLowerCase();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const filtered = allEvents.filter(e =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const eTags = Array.isArray(e.tags) ? e.tags.join(',') : (e.tags || '');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (currentTag &amp;&amp; !eTags.includes(currentTag)) return false;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (key &amp;&amp; !(e.title + e.location).toLowerCase().includes(key)) return false;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>return true;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const listContainer = document.getElementById('events-list');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>listContainer.innerHTML = filtered.map(e =&gt; `</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="event-card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="favorite-button" data-id="${e.id}"&gt;${favIds.has(e.id.toString()) ? 'â¤ï¸' : 'ğŸ¤'}&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>${e.image_url ? `&lt;img src="${e.image_url}" class="event-image"&gt;` : ''}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;h3&gt;${e.title}&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;p&gt;ğŸ“ ${e.location} &lt;br&gt; ğŸ“… ${new Date(e.date).toLocaleDateString()}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="action-buttons"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;a href="https://www.google.com/calendar/render?action=TEMPLATE&amp;text=${encodeURIComponent(e.title)}" target="_blank" class="calendar-button"&gt;ğŸ“… ç™»éŒ²&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;a href="https://mail.google.com/mail/?view=cm&amp;fs=1&amp;su=${encodeURIComponent(e.title)}&amp;body=${encodeURIComponent(window.location.href)}" target="_blank" class="mail-button"&gt;ğŸ“§ Gmail&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;a href="https://line.me/R/msg/text/?${encodeURIComponent(e.title)}" target="_blank" class="line-button"&gt;ğŸ’¬ LINE&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="review-section"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;h4&gt;ãƒ¬ãƒ“ãƒ¥ãƒ¼ â­&lt;/h4&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="review-form"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="star-selector" data-event-id="${e.id}"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;span class="star-input" data-val="1"&gt;â˜…&lt;/span&gt;&lt;span class="star-input" data-val="2"&gt;â˜…&lt;/span&gt;&lt;span class="star-input" data-val="3"&gt;â˜…&lt;/span&gt;&lt;span class="star-input" data-val="4"&gt;â˜…&lt;/span&gt;&lt;span class="star-input" data-val="5"&gt;â˜…&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;input type="text" class="review-input" placeholder="æ„Ÿæƒ³ã‚’å…¥åŠ›..." id="input-${e.id}"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button onclick="window.sendReview(${e.id})" style="margin-top:5px; padding:5px; background:#00A3A0; color:white; border:none; border-radius:5px; cursor:pointer;"&gt;æŠ•ç¨¿&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div id="reviews-list-${e.id}"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>`).join('') || '&lt;p&gt;è©²å½“ãªã—&lt;/p&gt;';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// ãŠæ°—ã«å…¥ã‚Šãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>listContainer.querySelectorAll('.favorite-button').forEach(btn =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>btn.onclick = async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const eventId = btn.dataset.id;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (favIds.has(eventId)) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>await supabase.from('favorites').delete().match({ user_id: userId, event_id: eventId });</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>favIds.delete(eventId);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>await supabase.from('favorites').insert({ user_id: userId, event_id: eventId });</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>favIds.add(eventId);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>renderEvents();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>};</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// æ˜Ÿè©•ä¾¡</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>listContainer.querySelectorAll('.star-selector').forEach(sel =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>let currentRating = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const stars = sel.querySelectorAll('.star-input');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>stars.forEach(star =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>star.onclick = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>currentRating = star.dataset.val;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>stars.forEach(s =&gt; s.classList.toggle('active', s.dataset.val &lt;= currentRating));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>sel.dataset.rating = currentRating;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>};</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// ãƒ¬ãƒ“ãƒ¥ãƒ¼èª­ã¿è¾¼ã¿</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>filtered.forEach(e =&gt; loadReviews(e.id));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>async function loadReviews(eventId) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const { data, error } = await supabase.from('reviews')</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>.select('*').eq('event_id', eventId).order('created_at', { ascending: false });</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const container = document.getElementById(`reviews-list-${eventId}`);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (container &amp;&amp; data) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>container.innerHTML = data.map(r =&gt; `</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="review-item"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="review-header"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;span&gt;ğŸ‘¤ ã‚²ã‚¹ãƒˆ&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;span class="review-stars"&gt;${'â­'.repeat(r.rating)}&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="review-text"&gt;${r.comment}&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>`).join('');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.sendReview = async (eventId) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const input = document.getElementById(`input-${eventId}`);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const selector = document.querySelector(`.star-selector[data-event-id="${eventId}"]`);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const rating = selector.dataset.rating || 0;</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (rating == 0) return alert("æ˜Ÿè©•ä¾¡ã‚’é¸ã‚“ã§ãã ã•ã„");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (!input.value.trim()) return alert("ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const { error } = await supabase.from('reviews').insert({</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>event_id: eventId,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>user_id: userId, // ä»®ã®ID</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>user_name: 'Guest',</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>rating: parseInt(rating),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>comment: input.value</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (error) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>alert("ã‚¨ãƒ©ãƒ¼: " + error.message);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>input.value = "";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>selector.dataset.rating = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>selector.querySelectorAll('.star-input').forEach(s =&gt; s.classList.remove('active'));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>loadReviews(eventId); // å³åº§ã«å†èª­ã¿è¾¼ã¿</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>document.getElementById('search-button').onclick = () =&gt; renderEvents();</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// åˆå›èª­ã¿è¾¼ã¿</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>load();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
